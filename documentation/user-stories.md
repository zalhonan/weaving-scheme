# User Stories проекта "Схемы на сетке"

---

## Эпик 1: Фундамент + базовое рисование + UI оболочка

### US-1.1: Отображение канвы с сеткой
**Как** пользователь
**Я хочу** видеть канву с сеткой в клеточку
**Чтобы** понимать, где рисовать линии

**Критерии приёмки:**
- [ ] Канва отображается по центру экрана
- [ ] Сетка расчерчена тонкими серыми линиями
- [ ] Размер канвы по умолчанию 20x20 клеток
- [ ] Современный легкий дизайн, приятный глазу

---

### US-1.2: Нумерация и разметка
**Как** пользователь
**Я хочу** видеть номера клеток и разметку по 10
**Чтобы** ориентироваться на канве

**Критерии приёмки:**
- [ ] Номера клеток отображаются по горизонтали (сверху)
- [ ] Номера клеток отображаются по вертикали (слева)
- [ ] Нумерация начинается с 0
- [ ] Каждые 10 клеток — чуть утолщённые, но бледные линии (как на миллиметровке)

---

### US-1.3: Рисование линии кликом
**Как** пользователь
**Я хочу** ставить линию по клику левой кнопкой мыши
**Чтобы** рисовать схему

**Критерии приёмки:**
- [ ] Левый клик на границе между клетками ставит линию
- [ ] Толерантность попадания — 1/4 клетки (не нужно целиться точно)
- [ ] Линия визуально отличается от сетки (контрастнее)
- [ ] Повторный клик по той же границе не удаляет линию

---

### US-1.4: Стирание линии кликом
**Как** пользователь
**Я хочу** стирать линию по клику правой кнопкой мыши
**Чтобы** исправлять ошибки

**Критерии приёмки:**
- [ ] Правый клик на нарисованной линии удаляет её
- [ ] Правый клик на пустой границе ничего не делает
- [ ] Контекстное меню браузера не появляется

---

### US-1.5: Drag-рисование
**Как** пользователь
**Я хочу** рисовать линии, ведя мышкой с зажатой левой кнопкой
**Чтобы** быстро рисовать несколько линий подряд

**Критерии приёмки:**
- [ ] При движении с зажатой левой кнопкой линии ставятся по пути курсора
- [ ] Работает плавно без пропусков
- [ ] При горизонтальном движении не рисуются случайные вертикальные линии (и наоборот)
- [ ] Переключение направления происходит только когда курсор прошёл половину клетки в перпендикулярном направлении

---

### US-1.6: Drag-стирание
**Как** пользователь
**Я хочу** стирать линии, ведя мышкой с зажатой правой кнопкой
**Чтобы** быстро стирать несколько линий подряд

**Критерии приёмки:**
- [ ] При движении с зажатой правой кнопкой линии стираются по пути курсора
- [ ] Контекстное меню браузера не появляется
- [ ] При горизонтальном движении не стираются случайные вертикальные линии (и наоборот)
- [ ] Переключение направления происходит только когда курсор прошёл половину клетки в перпендикулярном направлении

---

### US-1.7: Боковое меню
**Как** пользователь
**Я хочу** иметь боковое меню с функциями
**Чтобы** управлять приложением

**Критерии приёмки:**
- [ ] Меню расположено слева
- [ ] Меню можно свернуть/развернуть
- [ ] В свёрнутом состоянии не мешает рисованию
- [ ] Дизайн лёгкий и современный

---

### US-1.8: Кнопка Reset
**Как** пользователь
**Я хочу** очищать канву одной кнопкой
**Чтобы** начать рисовать заново

**Критерии приёмки:**
- [ ] Кнопка Reset в боковом меню
- [ ] По нажатию все линии удаляются
- [ ] Размер канвы остаётся прежним
- [ ] Запрос подтверждения перед очисткой (опционально)

---

### US-1.9: Статистика
**Как** пользователь
**Я хочу** видеть статистику рисунка
**Чтобы** понимать его размеры

**Критерии приёмки:**
- [ ] Отображается размер канвы (например, "20×20")
- [ ] Отображается размер фигуры — ширина × высота области, занятой линиями (например, "15×18"), без координат
- [ ] Отображается количество горизонтальных линий
- [ ] Отображается количество вертикальных линий
- [ ] Статистика обновляется в реальном времени при каждом изменении (не только после перезагрузки)

---

### US-1.10: Автосохранение
**Как** пользователь
**Я хочу** чтобы моя работа сохранялась автоматически
**Чтобы** не потерять её при закрытии браузера

**Критерии приёмки:**
- [ ] Состояние сохраняется в localStorage при каждом изменении
- [ ] При открытии приложения восстанавливается последняя работа
- [ ] Сохраняются: линии, размер канвы

---

## Эпик 2: Навигация и управление канвой

### US-2.1: Масштабирование колесом мыши
**Как** пользователь
**Я хочу** масштабировать канву колесом мыши
**Чтобы** видеть детали или общую картину

**Критерии приёмки:**
- [ ] Прокрутка вверх — увеличение
- [ ] Прокрутка вниз — уменьшение
- [ ] Минимум: 8 px на клетку
- [ ] Максимум: 50 px на клетку
- [ ] Масштабирование относительно позиции курсора

---

### US-2.2: Панорамирование
**Как** пользователь
**Я хочу** перемещать канву средней кнопкой мыши
**Чтобы** просматривать разные части большой схемы

**Критерии приёмки:**
- [ ] Зажатая средняя кнопка + движение = перемещение канвы
- [ ] Курсор меняется на "grab" при панорамировании
- [ ] Работает плавно

---

### US-2.3: Изменение размера канвы (относительное)
**Как** пользователь
**Я хочу** добавлять/убавлять клетки с каждой стороны канвы
**Чтобы** расширять или сужать рабочую область

**Критерии приёмки:**
- [ ] Интерфейс в виде "креста" из инпутов (сверху, снизу, слева, справа)
- [ ] Инпуты предзаполнены числом 10
- [ ] Около каждого инпута кнопки + и -
- [ ] В центре кнопки + и - для добавления/удаления со всех сторон
- [ ] Рисунок сдвигается при добавлении сверху/слева
- [ ] Дизайн лёгкий и понятный

---

### US-2.3.1: Установка точного размера канвы
**Как** пользователь
**Я хочу** задать точный размер канвы в клетках
**Чтобы** установить нужные мне размеры

**Критерии приёмки:**
- [ ] Два инпута для ширины и высоты, предзаполненные текущими значениями
- [ ] Кнопка "Установить" для применения нового размера
- [ ] При увеличении — рисунок центрируется (добавляются клетки равномерно со всех сторон)
- [ ] При уменьшении — рисунок обрезается поровну с краёв
- [ ] Минимальный размер — 1×1

---

### US-2.4: Undo/Redo
**Как** пользователь
**Я хочу** отменять и повторять действия
**Чтобы** исправлять ошибки

**Критерии приёмки:**
- [ ] Кнопки Undo и Redo в меню
- [ ] Undo отменяет последнее действие
- [ ] Redo повторяет отменённое действие
- [ ] История сохраняется в рамках сессии

---

### US-2.5: Информер горячих клавиш
**Как** пользователь
**Я хочу** видеть список горячих клавиш
**Чтобы** быстрее работать

**Критерии приёмки:**
- [ ] Раскрывающийся блок в меню
- [ ] Содержит: Shift+click — протянуть линию
- [ ] Содержит: Ctrl+click — залить все линии в пределах границ
- [ ] Можно свернуть/развернуть

---

## Эпик 3: Продвинутое рисование

### US-3.1: Shift+клик — протягивание линии
**Как** пользователь
**Я хочу** протягивать линию до ближайшей границы через Shift+клик
**Чтобы** быстро рисовать длинные линии

**Критерии приёмки:**
- [ ] Shift + левый клик на границе
- [ ] Направление (гориз./верт.) определяется по области клика
- [ ] Линия протягивается до ближайшей закрашенной границы в этом направлении
- [ ] Если закрашенной границы нет — ничего не происходит
- [ ] Shift + правый клик пока ничего не делает

---

### US-3.2: Ctrl+клик — заливка контура
**Как** пользователь
**Я хочу** заполнять замкнутый контур линиями через Ctrl+клик
**Чтобы** быстро закрашивать области

**Критерии приёмки:**
- [ ] Ctrl + левый клик внутри контура
- [ ] Все границы внутри контура заполняются линиями (flood fill)
- [ ] Контур должен быть замкнут
- [ ] Если контур не замкнут — toast "заливка невозможна, контур не замкнут" на 2-3 секунды
- [ ] Ctrl + правый клик пока ничего не делает

---

### US-3.3: Клик по "хвостам" линий
**Как** пользователь
**Я хочу** рисовать/стирать линию на всю высоту/ширину одним кликом
**Чтобы** быстро создавать сквозные линии

**Критерии приёмки:**
- [ ] "Хвосты" — продолжения линий сетки за нумерацией, видимые на канве
- [ ] Хвосты визуально продолжаются примерно на половину клетки за областью нумерации
- [ ] Левый клик по хвосту — рисует линию на всю высоту/ширину текущим цветом
- [ ] Если линии уже существуют, они перекрашиваются в текущий цвет
- [ ] Правый клик по хвосту — стирает линию на всю высоту/ширину

---

## Эпик 4: Цвета

### US-4.1: Выбор цвета в меню
**Как** пользователь
**Я хочу** выбирать цвет для рисования
**Чтобы** создавать цветные схемы

**Критерии приёмки:**
- [ ] В меню доступно 12 цветов (палитра Google Material Design), 6 в ряд
- [ ] Белый цвет вторым после черного (дефолт для закраски клеток)
- [ ] Цвета контрастные, но приятные
- [ ] Текущий выбранный цвет выделен визуально

---

### US-4.2: Рисование цветными линиями
**Как** пользователь
**Я хочу** рисовать линии выбранным цветом
**Чтобы** различать разные части схемы

**Критерии приёмки:**
- [ ] Новые линии рисуются выбранным цветом
- [ ] Можно перекрасить существующую линию (кликнуть по ней другим цветом)

---

### US-4.3: Закраска строк/столбцов
**Как** пользователь
**Я хочу** закрашивать целые строки или столбцы клеток
**Чтобы** выделять зоны на схеме

**Критерии приёмки:**
- [ ] Левый клик на номере строки — закрашивает всю строку клеток
- [ ] Левый клик на номере столбца — закрашивает весь столбец клеток
- [ ] Закраска отображается мгновенно (не требует дополнительных действий)
- [ ] Закрашиваются клетки, не линии
- [ ] Цвет закраски — бледная версия выбранного цвета
- [ ] Линии и разметка читаются поверх закраски
- [ ] Правый клик на номере — снимает закраску (дефолтный цвет)
- [ ] Разные строки/столбцы можно закрасить разными цветами
- [ ] На пересечении закрашенных строки и столбца — последний применённый цвет

---

## Эпик 5: Экспорт и печать

### US-5.1: Выгрузка в JSON
**Как** пользователь
**Я хочу** сохранять схему в JSON файл
**Чтобы** делиться ею или создавать резервную копию

**Критерии приёмки:**
- [ ] Кнопка "Экспорт в JSON" в меню
- [ ] Скачивается файл .json
- [ ] Структура файла содержит все данные для восстановления схемы

---

### US-5.2: Загрузка из JSON
**Как** пользователь
**Я хочу** загружать схему из JSON файла
**Чтобы** продолжить работу или открыть чужую схему

**Критерии приёмки:**
- [ ] Кнопка "Загрузить из JSON" в меню
- [ ] Выбор файла через диалог
- [ ] Схема полностью восстанавливается
- [ ] При ошибке формата — понятное сообщение

---

### US-5.3: Печать в PDF
**Как** пользователь
**Я хочу** печатать схему на бумаге
**Чтобы** использовать её офлайн

**Критерии приёмки:**
- [ ] Кнопка "Печать" в меню
- [ ] Формат: А4, клетка 7 мм
- [ ] Если схема большая — автоматическая разбивка на несколько страниц
- [ ] Страницы пронумерованы для удобства склейки
- [ ] Генерируется PDF файл

---

## Эпик 6: Мобильная адаптация (Touch)

### US-6.1: Рисование одним касанием
**Как** пользователь на мобильном устройстве
**Я хочу** рисовать линии касанием пальца
**Чтобы** создавать схемы без мыши

**Критерии приёмки:**
- [ ] Одиночное касание на границе клеток ставит линию
- [ ] Толерантность попадания увеличена для пальца (1/3 клетки)
- [ ] Работает аналогично левому клику мыши
- [ ] Нет конфликта с браузерными жестами

---

### US-6.2: Стирание долгим нажатием
**Как** пользователь на мобильном устройстве
**Я хочу** стирать линии через долгое нажатие
**Чтобы** исправлять ошибки без правой кнопки мыши

**Критерии приёмки:**
- [ ] Долгое нажатие (~300ms) на линии стирает её
- [ ] Визуальная обратная связь при активации (вибрация или подсветка)
- [ ] После активации можно вести пальцем для непрерывного стирания
- [ ] При отмене жеста (до 300ms) — ничего не происходит

---

### US-6.3: Drag-рисование касанием
**Как** пользователь на мобильном устройстве
**Я хочу** рисовать линии, ведя пальцем по экрану
**Чтобы** быстро рисовать несколько линий подряд

**Критерии приёмки:**
- [ ] При движении пальца линии ставятся по пути
- [ ] Работает плавно без пропусков
- [ ] При горизонтальном движении не рисуются случайные вертикальные линии
- [ ] Переключение направления аналогично drag мышью

---

### US-6.4: Pinch-zoom (масштабирование)
**Как** пользователь на мобильном устройстве
**Я хочу** масштабировать канву сведением/разведением двух пальцев
**Чтобы** видеть детали или общую картину

**Критерии приёмки:**
- [ ] Сведение пальцев — уменьшение масштаба
- [ ] Разведение пальцев — увеличение масштаба
- [ ] Масштабирование относительно центра между пальцами
- [ ] Плавная анимация без рывков
- [ ] Лимиты масштаба: 8–50 px на клетку
- [ ] Во время жеста рисование блокируется

---

### US-6.5: Pan двумя пальцами (панорамирование)
**Как** пользователь на мобильном устройстве
**Я хочу** перемещать канву двумя пальцами
**Чтобы** просматривать разные части большой схемы

**Критерии приёмки:**
- [ ] Движение двумя пальцами = перемещение канвы
- [ ] Можно совмещать с pinch-zoom в одном жесте
- [ ] Плавное перемещение без рывков
- [ ] Во время жеста рисование блокируется

---

### US-6.6: Различение рисования и навигации
**Как** система
**Я должна** корректно различать рисование и навигационные жесты
**Чтобы** пользователь не рисовал случайные линии при масштабировании

**Критерии приёмки:**
- [ ] При касании одним пальцем — задержка 50ms перед началом рисования
- [ ] Если второй палец появился в течение 50ms — переход в режим навигации
- [ ] Режим блокируется до полного отпускания всех пальцев
- [ ] Точки, записанные до определения режима, отбрасываются при навигации

---

### US-6.7: Undo/Redo жестами
**Как** пользователь на мобильном устройстве
**Я хочу** отменять действия жестами
**Чтобы** быстро исправлять ошибки без кнопок

**Критерии приёмки:**
- [ ] Тап двумя пальцами = Undo
- [ ] Тап тремя пальцами = Redo
- [ ] Визуальная индикация срабатывания (кратковременный значок на экране)
- [ ] Жесты не конфликтуют с навигацией (различаются по времени касания)

---

### US-6.8: Плавающая панель инструментов
**Как** пользователь на мобильном устройстве
**Я хочу** иметь компактную панель инструментов
**Чтобы** получить доступ к функциям без загромождения экрана

**Критерии приёмки:**
- [ ] Плавающая панель с основными инструментами
- [ ] Возможность свернуть в одну иконку
- [ ] Возможность перетаскивать по экрану
- [ ] Кнопки минимум 44×44px для удобства нажатия
- [ ] Содержит: Undo, Redo, текущий цвет, меню

---

### US-6.9: Адаптивное боковое меню
**Как** пользователь на мобильном устройстве
**Я хочу** чтобы боковое меню адаптировалось под размер экрана
**Чтобы** оно не мешало работе

**Критерии приёмки:**
- [ ] На мобильных — меню в виде overlay (на весь экран)
- [ ] Открытие по свайпу от левого края или кнопке
- [ ] Автоматическое закрытие при выборе действия
- [ ] На планшетах в ландшафте — как на десктопе (боковая панель)

---

### US-6.10: Retina-совместимость канвы
**Как** пользователь с устройством с высоким DPI
**Я хочу** видеть чёткие линии и сетку
**Чтобы** схема хорошо выглядела на современных экранах

**Критерии приёмки:**
- [ ] Canvas масштабируется с учётом devicePixelRatio
- [ ] Линии и сетка остаются чёткими при любом масштабе устройства
- [ ] Производительность не страдает на устройствах с высоким DPI

---

### US-6.11: Блокировка браузерных жестов
**Как** система
**Я должна** предотвращать стандартные жесты браузера на канве
**Чтобы** пользователь не уходил со страницы и не обновлял её случайно

**Критерии приёмки:**
- [ ] Pull-to-refresh отключён на канве
- [ ] Свайп назад/вперёд браузера не срабатывает при работе с канвой
- [ ] Браузерный зум отключён (используется свой)
- [ ] Контекстное меню не появляется при долгом нажатии

---

### US-6.12: Подсказки по жестам
**Как** новый пользователь на мобильном устройстве
**Я хочу** видеть подсказки по управлению жестами
**Чтобы** быстро освоить приложение

**Критерии приёмки:**
- [ ] При первом запуске — краткий onboarding с основными жестами
- [ ] Можно пропустить или вызвать повторно из меню
- [ ] Анимированные иллюстрации жестов
- [ ] Раздел "Жесты" в справке с полным списком

---

### US-6.13: Кнопки-компаньоны
**Как** пользователь, которому неудобны мультитач-жесты
**Я хочу** иметь кнопки для Undo/Redo и других частых действий
**Чтобы** работать одной рукой

**Критерии приёмки:**
- [ ] Опциональная плавающая панель с кнопками Undo/Redo
- [ ] Можно включить/выключить в настройках
- [ ] Кнопки не мешают рисованию (полупрозрачные или сдвигаемые)
- [ ] Удерживание кнопки Undo = быстрая многократная отмена

---

### US-6.14: Закраска строк/столбцов на мобильных
**Как** пользователь на мобильном устройстве
**Я хочу** закрашивать строки и столбцы
**Чтобы** выделять зоны как на десктопе

**Критерии приёмки:**
- [ ] Тап по номеру строки/столбца — закрашивает
- [ ] Долгий тап по номеру — снимает закраску
- [ ] Область нажатия увеличена для удобства

---

### US-6.15: Оптимизация производительности жестов
**Как** система
**Я должна** обеспечивать плавную работу жестов
**Чтобы** пользователь не испытывал задержек

**Критерии приёмки:**
- [ ] Во время pinch/pan — используются CSS transform (без перерисовки)
- [ ] Перерисовка canvas только после завершения жеста
- [ ] Touch события обрабатываются с throttling при необходимости
- [ ] Нет заметных лагов на устройствах средней производительности

---

## Сводка покрытия ТЗ

| Пункт ТЗ | User Story |
|----------|------------|
| Канва с сеткой | US-1.1 |
| Нумерация с 0 | US-1.2 |
| Разметка по 10 клеток | US-1.2 |
| Левый клик = линия | US-1.3 |
| Толерантность 1/4 клетки | US-1.3 |
| Правый клик = стирание | US-1.4 |
| Drag-рисование | US-1.5 |
| Drag-стирание | US-1.6 |
| Боковое меню | US-1.7 |
| Reset | US-1.8 |
| Статистика | US-1.9 |
| Автосохранение localStorage | US-1.10 |
| Масштабирование 8-50 px | US-2.1 |
| Масштаб относительно курсора | US-2.1 |
| Панорамирование средней кнопкой | US-2.2 |
| Изменение размера канвы | US-2.3 |
| Undo/Redo | US-2.4 |
| Информер горячих клавиш | US-2.5 |
| Shift+клик протягивание | US-3.1 |
| Ctrl+клик flood fill | US-3.2 |
| Toast при незамкнутом контуре | US-3.2 |
| Клик по хвостам линий | US-3.3 |
| Выбор цвета (8 цветов) | US-4.1 |
| Рисование цветными линиями | US-4.2 |
| Перекрашивание линий | US-4.2 |
| Закраска строк/столбцов | US-4.3 |
| Бледный цвет для клеток | US-4.3 |
| Пересечение = последний цвет | US-4.3 |
| Экспорт JSON | US-5.1 |
| Импорт JSON | US-5.2 |
| Печать PDF А4, 7 мм | US-5.3 |
| Разбивка на страницы + нумерация | US-5.3 |
| Современный лёгкий дизайн | US-1.1, US-1.7 |
| **Мобильная адаптация** | **Эпик 6** |
| Touch-рисование | US-6.1, US-6.3 |
| Touch-стирание | US-6.2 |
| Pinch-zoom | US-6.4 |
| Pan двумя пальцами | US-6.5 |
| Различение рисования/навигации | US-6.6 |
| Undo/Redo жестами | US-6.7 |
| Мобильный UI (панель, меню) | US-6.8, US-6.9 |
| Retina-поддержка | US-6.10 |
| Блокировка браузерных жестов | US-6.11 |
| Onboarding жестов | US-6.12 |
| Кнопки-компаньоны | US-6.13 |
| Закраска строк на мобильных | US-6.14 |
| Оптимизация производительности | US-6.15 |
