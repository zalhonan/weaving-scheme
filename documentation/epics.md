# Эпики проекта "Схемы на сетке"

**Стек:** React + Vite + Zustand + TypeScript

---

## Эпик 1: Фундамент + базовое рисование + UI оболочка

### Функционал
- Канва с сеткой, нумерацией (с 0), разметкой по 10 клеток
- Базовое рисование (левый клик = линия, толерантность 1/4 клетки) и стирание (правый клик)
- Drag-рисование и drag-стирание
- Автосохранение в localStorage
- Сворачиваемое боковое меню:
  - Кнопка Reset (очистка поля, размер остаётся)
  - Статистика: размер канвы, bounding box рисунка, кол-во линий

### Архитектура (закладываем сразу)
- Модель линии: `{x, y, orientation, color}` — цвет сразу в структуре
- Модель закраски клеток: `{type: 'row'|'col', index, color, timestamp}` — timestamp для определения цвета на пересечениях
- State management (Zustand) с поддержкой истории (для будущего Undo/Redo)
- Детальное описание архитектуры: см. `architecture.md`

### Ценность
Полноценный рабочий инструмент: можно рисовать схемы, видеть статистику, сбрасывать, не терять работу при закрытии браузера.

---

## Эпик 2: Навигация и управление канвой

### Функционал
- Масштабирование колесом мыши (8–50 px/клетка, относительно курсора)
- Панорамирование зажатой средней кнопкой мыши
- Изменение размера канвы ("крест" из инпутов с кнопками +/-)
- Undo / Redo (UI в меню + активация логики из Эпика 1)
- Информер с горячими клавишами (раскрывающийся блок в меню)

### Ценность
Полный контроль над рабочей областью: навигация по большим схемам, изменение размера, отмена ошибок.

---

## Эпик 3: Продвинутое рисование

### Функционал
- Shift+левый клик — протягивание линии до ближайшей закрашенной границы
- Ctrl+левый клик — flood fill внутри замкнутого контура (+ toast "контур не замкнут" при ошибке)
- Клик по "хвостам" линий — рисование/стирание на всю высоту или ширину канвы

### Ценность
Быстрое создание сложных схем без утомительного клика по каждой линии.

---

## Эпик 4: Цвета

### Функционал
- Выбор цвета в меню (8 цветов, палитра Google)
- Рисование линий выбранным цветом
- Перекрашивание существующих линий (клик другим цветом)
- Закраска строк/столбцов (клик по номеру), снятие закраски (правый клик)
- Бледный цвет для клеток, чтобы линии читались

### Ценность
Цветовое кодирование для лучшей читаемости схем.

---

## Эпик 5: Экспорт и печать

### Функционал
- Выгрузка в JSON
- Загрузка из JSON
- Печать в PDF:
  - Лист А4, клетка 7 мм
  - Автоматическая разбивка на страницы при большом размере
  - Нумерация страниц

### Ценность
Сохранение, обмен схемами и физическая печать.

---

## Порядок и зависимости

```
Эпик 1 (Фундамент + UI)
    ↓
Эпик 2 (Навигация + Управление + Undo/Redo)
    ↓
Эпик 3 (Продвинутое рисование)
    ↓
Эпик 4 (Цвета)
    ↓
Эпик 5 (Экспорт)
```

---

## Принципы минимизации переделок

| Что закладываем сразу | Зачем |
|-----------------------|-------|
| Цвет в модели линии | Не менять структуру данных в Эпике 4 |
| История состояний (Zustand) | Undo/Redo сложно добавить постфактум |
| localStorage с Эпика 1 | Пользователь не теряет работу |
| Меню с Эпика 1 | Не перестраивать layout позже |

---

## Эпик 6: Мобильная адаптация (Touch)

### Функционал

#### Базовое рисование касаниями
- Одиночное касание = рисование линии (аналог левого клика)
- Долгое нажатие (long press) = стирание линии (аналог правого клика)
- Drag одним пальцем = непрерывное рисование
- Drag одним пальцем после long press = непрерывное стирание

#### Жесты навигации (два пальца)
- Pinch (сведение/разведение) = масштабирование
- Pan двумя пальцами = панорамирование канвы
- Опционально: вращение двумя пальцами для поворота вида

#### Жесты отмены действий
- Тап двумя пальцами = Undo
- Тап тремя пальцами = Redo
- Либо свайп влево тремя пальцами = Undo, вправо = Redo

#### Адаптивный интерфейс
- Плавающая сворачиваемая панель инструментов
- Кнопки минимум 44×44px (Apple Human Interface Guidelines)
- Нижняя панель для доступа большим пальцем
- Адаптивное боковое меню (overlay на мобильных)

#### Техническая адаптация
- CSS `touch-action: none` для предотвращения браузерных жестов
- Учёт devicePixelRatio для чёткости на Retina-дисплеях
- Различение single-touch и multi-touch с задержкой ~50-100ms
- Оптимизация: CSS transform во время жестов, перерисовка canvas после

#### Обучение пользователя
- Подсказки по жестам при первом запуске
- Плавающие кнопки-компаньоны для Undo/Redo/Zoom (альтернатива жестам)
- Раздел "Жесты" в справке

### Архитектура (учитываем)
- Унифицированный обработчик ввода (Pointer Events вместо отдельных Mouse/Touch)
- Стратегия различения рисования и навигационных жестов:
  - При одном касании — задержка ~50ms для проверки второго пальца
  - Если второй палец появился — режим навигации
  - Если нет — режим рисования (блокируется до отпускания)
- Слой абстракции для переключения между режимами ввода

### Ценность
Полноценная работа на планшетах и смартфонах с интуитивным управлением жестами.

### Лучшие практики (источники)
- [Procreate Gestures](https://help.procreate.com/procreate/handbook/interface-gestures/gestures) — стандарт индустрии для рисовалок
- [Konva.js Touch Events](https://konvajs.org/docs/events/Mobile_Events.html) — multi-touch для canvas
- [Material Design Gestures](https://m1.material.io/patterns/gestures.html) — стандартные паттерны жестов
- [MDN Touch Events](https://developer.mozilla.org/en-US/docs/Web/API/Touch_events) — техническая документация
- [Apple Touch Handling](https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/HTML-canvas-guide/AddingMouseandTouchControlstoCanvas/AddingMouseandTouchControlstoCanvas.html) — лучшие практики iOS

---

## Порядок и зависимости (обновлённый)

```
Эпик 1 (Фундамент + UI)
    ↓
Эпик 2 (Навигация + Управление + Undo/Redo)
    ↓
Эпик 3 (Продвинутое рисование)
    ↓
Эпик 4 (Цвета)
    ↓
Эпик 5 (Экспорт)
    ↓
Эпик 6 (Мобильная адаптация) — можно начать параллельно с Эпика 3
```

---

## Что отложено

- Офлайн-режим (PWA) — возможное расширение после Эпика 6
